{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://aegiside.org/schemas/progress.json",
  "title": "Progress Schema",
  "$defs": {
    "workflow_id": {"type": "string", "pattern": "^wf-[A-Za-z0-9_-]+$"},
    "task_id": {"type": "string", "pattern": "^task-[A-Za-z0-9_-]+$"}
  },
  "description": "RL ledger with metrics as SOURCE OF TRUTH for all schemas, synced to activeContext",
  "type": "object",
  "required": ["schema_version", "reinforcement_learning"],
  "properties": {
    "schema_version": {"type": "string", "pattern": "^\\d+\\.\\d+\\.\\d+$"},
    "last_updated": {"type": "string", "format": "date-time"},
    "metrics": {
      "type": "object",
      "description": "SOURCE OF TRUTH - activeContext.metrics syncs total_rl_score from here",
      "required": ["total_rl_score", "tasks_completed", "commits"],
      "properties": {
        "total_rl_score": {"type": "number"},
        "tasks_completed": {"type": "integer", "minimum": 0},
        "tasks_failed": {"type": "integer", "minimum": 0},
        "commits": {"type": "integer", "minimum": 0}
      }
    },
    "reinforcement_learning": {
      "type": "array",
      "description": "Transaction log - prepend entries at [0]",
      "maxItems": 100,
      "items": {
        "type": "object",
        "required": ["workflow", "timestamp", "reason"],
        "properties": {
          "workflow": {"type": "string"},
          "rl_reward": {"type": "number", "minimum": 0},
          "rl_penalty": {"type": "number", "maximum": 0},
          "reason": {"type": "string"},
          "timestamp": {"type": "string", "format": "date-time"},
          "schemas_updated": {"type": "array", "items": {"type": "string"}},
          "mcp_chain": {"type": "array", "items": {"type": "string"}}
        }
      }
    },
    "current_focus": {
      "type": "object",
      "properties": {
        "task": {"type": "string"},
        "tests_ready": {"type": "array", "items": {"type": "string"}}
      }
    }
  }
}
