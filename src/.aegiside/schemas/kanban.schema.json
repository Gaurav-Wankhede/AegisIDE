{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": ["schema_version", "last_updated", "metrics", "columns"],
  "properties": {
    "schema_version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "last_updated": {
      "type": "string",
      "format": "date-time"
    },
    "metrics": {
      "type": "object",
      "description": "SYNCED FROM progress.json after every task",
      "required": ["total_rl_score", "tasks_completed"],
      "properties": {
        "total_rl_score": {"type": "number"},
        "tasks_completed": {"type": "integer", "minimum": 0},
        "tasks_failed": {"type": "integer", "minimum": 0},
        "commits": {"type": "integer", "minimum": 0}
      }
    },
    "columns": {
      "type": "object",
      "properties": {
        "todo": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {"type": "string"},
              "title": {"type": "string"},
              "priority": {"type": "string"},
              "tags": {"type": "array", "items": {"type": "string"}},
              "added_at": {"type": "string", "format": "date-time"}
            }
          }
        },
        "in_progress": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {"type": "string"},
              "title": {"type": "string"},
              "priority": {"type": "string"},
              "tags": {"type": "array", "items": {"type": "string"}},
              "started_at": {"type": "string", "format": "date-time"}
            }
          }
        },
        "done": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {"type": "string"},
              "title": {"type": "string"},
              "completed_at": {"type": "string", "format": "date-time"},
              "tags": {"type": "array", "items": {"type": "string"}},
              "rl_impact": {"type": "number"},
              "cost_savings": {"type": "string"}
            }
          }
        },
        "approved": {
          "type": "array",
          "description": "Constitutional verification passed - Chief Justice + Opposition approval",
          "items": {
            "type": "object",
            "properties": {
              "id": {"type": "string"},
              "title": {"type": "string"},
              "approved_at": {"type": "string", "format": "date-time"},
              "tags": {"type": "array", "items": {"type": "string"}},
              "rl_impact": {"type": "number"},
              "constitutional_compliance": {"type": "number"},
              "approved_by": {"type": "string"}
            }
          }
        }
      }
    },
    "activity_log": {
      "type": "array",
      "description": "TOP-APPEND MANDATORY: Newest entry MUST be at [0]. Prepend, never append.",
      "items": {
        "type": "object",
        "required": ["id", "timestamp", "action", "task_id", "actor"],
        "properties": {
          "id": {"type": "string"},
          "timestamp": {"type": "string", "format": "date-time"},
          "action": {"type": "string"},
          "task_id": {"type": "string"},
          "actor": {"type": "string"},
          "details": {"type": "string"}
        }
      }
    }
  }
}
