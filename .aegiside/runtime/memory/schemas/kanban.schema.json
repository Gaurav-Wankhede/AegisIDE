{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": ["schema_version", "last_updated", "metrics", "columns"],
  "properties": {
    "schema_version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "last_updated": {
      "type": "string",
      "format": "date-time"
    },
    "metrics": {
      "type": "object",
      "description": "Local event log ONLY - Reference progress.json for total_rl_score",
      "required": ["rl_source_ref"],
      "properties": {
        "rl_source_ref": {"type": "string", "const": "progress.json", "description": "SINGLE SOURCE OF TRUTH for total_rl_score"},
        "tasks_completed": {"type": "integer", "minimum": 0},
        "tasks_failed": {"type": "integer", "minimum": 0},
        "commits": {"type": "integer", "minimum": 0}
      }
    },
    "columns": {
      "type": "object",
      "properties": {
        "todo": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {"type": "string"},
              "title": {"type": "string"},
              "priority": {"type": "string"},
              "tags": {"type": "array", "items": {"type": "string"}},
              "added_at": {"type": "string", "format": "date-time"}
            }
          }
        },
        "in_progress": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {"type": "string"},
              "title": {"type": "string"},
              "priority": {"type": "string"},
              "tags": {"type": "array", "items": {"type": "string"}},
              "started_at": {"type": "string", "format": "date-time"}
            }
          }
        },
        "done": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {"type": "string"},
              "title": {"type": "string"},
              "completed_at": {"type": "string", "format": "date-time"},
              "tags": {"type": "array", "items": {"type": "string"}},
              "rl_impact": {"type": "number"},
              "cost_savings": {"type": "string"}
            }
          }
        },
        "approved": {
          "type": "array",
          "description": "Constitutional verification passed - Chief Justice + Opposition approval",
          "items": {
            "type": "object",
            "required": ["id", "title", "approval_metadata"],
            "properties": {
              "id": {"type": "string"},
              "title": {"type": "string"},
              "approved_at": {"type": "string", "format": "date-time"},
              "tags": {"type": "array", "items": {"type": "string"}},
              "rl_impact": {"type": "number"},
              "constitutional_compliance": {"type": "number", "minimum": 80, "description": "Must be ≥80% to move to approved"},
              "approved_by": {"type": "string"},
              "approval_metadata": {
                "type": "object",
                "required": ["chief_justice_approved", "opposition_verified", "constitutional_compliance_verified"],
                "description": "Constitutional governance enforcement - Articles 29, 32",
                "properties": {
                  "chief_justice_approved": {"type": "boolean", "description": "Chief Justice constitutional review (Article 32)"},
                  "opposition_verified": {"type": "boolean", "description": "Shadow Cabinet quality audit (Article 29)"},
                  "constitutional_compliance_verified": {"type": "boolean", "description": "Compliance ≥80% verified"},
                  "approval_timestamp": {"type": "string", "format": "date-time"},
                  "validation_passed": {"type": "boolean", "description": "Zero-tolerance validation passed"},
                  "mcp_trail_complete": {"type": "boolean", "description": "All 9 MCPs used properly"},
                  "vetoed": {"type": "boolean", "default": false, "description": "Chief Justice veto if constitutional violation"},
                  "veto_reason": {"type": "string", "description": "Reason for veto if applicable"}
                }
              }
            }
          }
        }
      }
    },
    "activity_log": {
      "type": "array",
      "description": "TOP-APPEND MANDATORY: Newest entry MUST be at [0]. Prepend, never append.",
      "items": {
        "type": "object",
        "required": ["id", "timestamp", "action", "task_id", "actor"],
        "properties": {
          "id": {"type": "string"},
          "timestamp": {"type": "string", "format": "date-time"},
          "action": {"type": "string"},
          "task_id": {"type": "string"},
          "actor": {"type": "string"},
          "details": {"type": "string"}
        }
      }
    }
  }
}
